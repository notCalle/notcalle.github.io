<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#F15A29">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="alternate" type="application/rss+xml" title="not://files v3.0" href="https://notfiles.xyz/feed.xml">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Light and Magic | not://files v3.0</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Light and Magic" />
<meta name="author" content="Calle Englund" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Made some refinements to lighting. Originially there was only a point light without distance falloff, which is not an accurate light model in any case. The light inside the room lights the entire world, all the way to the horizon." />
<meta property="og:description" content="Made some refinements to lighting. Originially there was only a point light without distance falloff, which is not an accurate light model in any case. The light inside the room lights the entire world, all the way to the horizon." />
<link rel="canonical" href="https://notfiles.xyz/2019/01/08/light-and-magic/" />
<meta property="og:url" content="https://notfiles.xyz/2019/01/08/light-and-magic/" />
<meta property="og:site_name" content="not://files v3.0" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-08T20:31:49+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Light and Magic" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Calle Englund"},"dateModified":"2019-01-08T20:31:49+01:00","datePublished":"2019-01-08T20:31:49+01:00","description":"Made some refinements to lighting. Originially there was only a point light without distance falloff, which is not an accurate light model in any case. The light inside the room lights the entire world, all the way to the horizon.","headline":"Light and Magic","mainEntityOfPage":{"@type":"WebPage","@id":"https://notfiles.xyz/2019/01/08/light-and-magic/"},"url":"https://notfiles.xyz/2019/01/08/light-and-magic/"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css" integrity="sha384-ZPe7yZ91iWxYumsBEOn7ieg8q/o+qh/hQpSaPow8T6BwALcXSCS6C6fSRPIAnTQs" crossorigin="anonymous">

  <!-- The loading of KaTeX is deferred to speed up page rendering -->
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js" integrity="sha384-ljao5I1l+8KYFXG7LNEA7DyaFvuvSCmedUf6Y6JI7LJqiu8q5dEivP2nDdFH31V4" crossorigin="anonymous"></script>

  <!-- To automatically render math in text elements, include the auto-render extension: -->
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
      onload="renderMathInElement(document.body);"></script>
</head>
<body><header class="site-header">
  <div class="wrapper">
    <a class="site-title" href="/">not://files v3.0</a><nav class="site-nav" id="site-navigation" aria-label="Menu">
  <label for="site-menu-toggle" class="menu-icon" aria-label="Menu">
    <i class="fas fa-bars"></i>
  </label>
  <input id="site-menu-toggle" class="menu-toggle" type="checkbox"/><ul id="site-menu" class="menu">
    <li class="menu-item">
      <a class="page-link" href="/posts/">
          All Posts
        </a></li>
    <li class="menu-item">
      <a class="page-link" href="/archive/">
          Archives
        </a></li>
    <li class="menu-item">
      <a class="page-link" href="/category/">
          Categories
        </a></li>
    <li class="menu-item">
      <a class="page-link" href="/tag/">
          Tags
        </a></li>
</ul>
</nav>
</div>
</header>
<section class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Light and Magic</h1>
    <div class="post-meta"><time datetime="2019-01-08T20:31:49+01:00" itemprop="datePublished">Tuesday, 2019-01-08</time>
       in
    <a href="/category/devlog/"
       title="Development Logs">devlog</a>
   about
    <a href="/tag/raytracerchallenge/" title="">
      #raytracerchallenge</a>,
  
    <a href="/tag/ruby/" title="coding in Ruby">
      #ruby</a>,
  
    <a href="/tag/hourofcode/" title="coding for one hour per day">
      #hourofcode</a>
  </div></header>

  <section class="post-content" itemprop="articleBody">
    <p><img src="/img/2019/01/room-without-falloff.png" alt="Room with a Window" class="right" />
Made some refinements to lighting. Originially there was only a point light without distance falloff, which is not an accurate light model in any case. The light inside the room lights the entire world, all the way to the horizon.</p>

<p>To improve on the situation I rewrote the light model from scratch, keeping the original point light as a wrapper for simplified testing of the shading model.</p>

<p><img src="/img/2019/01/room-with-window.png" alt="Room with a Window" class="right" />
Two new kinds of lights, a <code class="language-plaintext highlighter-rouge">parallel</code> light that simulates an infinitely distant light source, so the incoming light rays are perfectly parallel and only have a direction. The other is a <code class="language-plaintext highlighter-rouge">spherical</code> light, which is a positional light source that radiates spherically, so intensity falls off with distance.</p>

<p>While I was at it, I refactored bits of the object hierarchy to enable light sources to be transformed and grouped just like any other object in the scene, so we can make reusable lamps.</p>

<div class="language-ruby clear highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shape</span><span class="p">.</span><span class="nf">group</span> <span class="ss">:ceiling_lamp</span> <span class="k">do</span> <span class="o">|</span><span class="n">lit</span> <span class="o">=</span> <span class="kp">true</span><span class="o">|</span>
  <span class="n">light</span><span class="p">.</span><span class="nf">spherical</span> <span class="p">{</span> <span class="n">falloff</span> <span class="mf">0.1</span> <span class="p">}</span> <span class="k">if</span> <span class="n">lit</span>
  <span class="n">shape</span><span class="p">.</span><span class="nf">sphere</span> <span class="k">do</span>
    <span class="n">scale</span> <span class="mf">0.1</span>
    <span class="n">material</span> <span class="k">do</span>
      <span class="n">color</span> <span class="ss">:white</span>
      <span class="n">ambient</span> <span class="mf">0.8</span>
      <span class="n">diffuse</span> <span class="mi">0</span>
      <span class="n">phong</span> <span class="mi">0</span>
    <span class="k">end</span>
    <span class="n">shadows</span> <span class="kp">false</span>
  <span class="k">end</span>
  <span class="n">shape</span><span class="p">.</span><span class="nf">cylinder</span> <span class="k">do</span>
    <span class="n">material</span> <span class="ss">:shiny_metal</span>
    <span class="n">scale</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.01</span>
    <span class="n">translate</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

  </section>
</article>
<section class="post-list"><h2>Next related</h2><article class="post-item">
  <header class="post-header">
    <h3 class="post-link">
      <a href="/2019/01/13/threaded-rendering/" >
        Threaded rendering
      </a>
    </h3>
    <div class="post-meta">Sunday, 2019-01-13 in
    <a href="/category/devlog/"
       title="Development Logs">devlog</a>
   about
    <a href="/tag/raytracerchallenge/" title="">
      #raytracerchallenge</a>,
  
    <a href="/tag/ruby/" title="coding in Ruby">
      #ruby</a>
  
    </div>
  </header>
  <section class="post-excerpt">
    <blockquote>
      Shaved another 30% off rendering time by inlining and some more caching, but it seems like Iâ€™m reaching the limit of what I can get out of a single thread.

    </blockquote>
  </section>
</article>
<h2>Previous related</h2><article class="post-item">
  <header class="post-header">
    <h3 class="post-link">
      <a href="/2019/01/06/cache-is-king/" >
        Cache is King
      </a>
    </h3>
    <div class="post-meta">Sunday, 2019-01-06 in
    <a href="/category/devlog/"
       title="Development Logs">devlog</a>
   about
    <a href="/tag/raytracerchallenge/" title="">
      #raytracerchallenge</a>,
  
    <a href="/tag/hourofcode/" title="coding for one hour per day">
      #hourofcode</a>,
  
    <a href="/tag/ruby/" title="coding in Ruby">
      #ruby</a>
  
    </div>
  </header>
  <section class="post-excerpt">
    <blockquote>
      Cut teapot rendering time in half with some clever caching.

    </blockquote>
  </section>
</article>
<article class="post-item">
  <header class="post-header">
    <h3 class="post-link">
      <a href="/2019/01/05/day-36-constructive-solid-geometry/" >
        Day 36, Constructive Solid Geometry
      </a>
    </h3>
    <div class="post-meta">Saturday, 2019-01-05 in
    <a href="/category/devlog/"
       title="Development Logs">devlog</a>
   about
    <a href="/tag/devember/" title="participation in Devember">
      #devember</a>,
  
    <a href="/tag/devember2018/" title="Devember 2018 ray tracer challenge">
      #devember2018</a>,
  
    <a href="/tag/raytracerchallenge/" title="">
      #raytracerchallenge</a>,
  
    <a href="/tag/hourofcode/" title="coding for one hour per day">
      #hourofcode</a>,
  
    <a href="/tag/ruby/" title="coding in Ruby">
      #ruby</a>
  
    </div>
  </header>
  <section class="post-excerpt">
    <blockquote>
      The final pre-defined feature of the project is done, Constructive Solid Geometry, implementing the boolean set operations union, intersection, and difference for solid geometries. This way we can use the basic geometric surface shapes to create more advanced shapes, without resorting to approximating by thousands of triangles.


    </blockquote>
  </section>
</article>
<article class="post-item">
  <header class="post-header">
    <h3 class="post-link">
      <a href="/2019/01/02/day-33-domain-specific-language/" >
        Day 33, Domain-Specific Language
      </a>
    </h3>
    <div class="post-meta">Wednesday, 2019-01-02 in
    <a href="/category/devlog/"
       title="Development Logs">devlog</a>
   about
    <a href="/tag/devember/" title="participation in Devember">
      #devember</a>,
  
    <a href="/tag/devember2018/" title="Devember 2018 ray tracer challenge">
      #devember2018</a>,
  
    <a href="/tag/hourofcode/" title="coding for one hour per day">
      #hourofcode</a>,
  
    <a href="/tag/raytracerchallenge/" title="">
      #raytracerchallenge</a>,
  
    <a href="/tag/ruby/" title="coding in Ruby">
      #ruby</a>
  
    </div>
  </header>
  <section class="post-excerpt">
    <blockquote>
      Not a single feature improvement today, but instead a bit of quality of life improvements.

    </blockquote>
  </section>
</article>
</section>

      </div>
    </section><footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Calle Englund</li>
          <li><a href="mailto:calle@notfiles.xyz">calle@notfiles.xyz</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list"><li title="GitHub">
            <a rel="me" href="https://github.com/notCalle">
              <i class="icon fab fa-github"></i>
              notCalle
            </a>
          </li><li title="Mastodon">
            <a rel="me" href="https://mstdn.social/@notCalle">
              <i class="icon fab fa-mastodon"></i>
              @notCalle@mstdn.social
            </a>
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        Random development ramblings, maybe.

      </div>
    </div>

  </div>

</footer>
</body>
</html>
