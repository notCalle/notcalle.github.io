<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#F15A29">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="alternate" type="application/rss+xml" title="not://files v3.0" href="https://notfiles.xyz/feed.xml">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Day 4, Intersections | not://files v3.0</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Day 4, Intersections" />
<meta name="author" content="Calle Englund" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="More math heavy stuff, calculating the positions along a ray, where it intersects a sphere. Turns out this is as simple as solving a quadratic equation, with some special coefficients." />
<meta property="og:description" content="More math heavy stuff, calculating the positions along a ray, where it intersects a sphere. Turns out this is as simple as solving a quadratic equation, with some special coefficients." />
<link rel="canonical" href="https://notfiles.xyz/2018/12/04/day-4-intersections/" />
<meta property="og:url" content="https://notfiles.xyz/2018/12/04/day-4-intersections/" />
<meta property="og:site_name" content="not://files v3.0" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-12-04T23:34:42+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Day 4, Intersections" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Calle Englund"},"dateModified":"2018-12-04T23:34:42+01:00","datePublished":"2018-12-04T23:34:42+01:00","description":"More math heavy stuff, calculating the positions along a ray, where it intersects a sphere. Turns out this is as simple as solving a quadratic equation, with some special coefficients.","headline":"Day 4, Intersections","mainEntityOfPage":{"@type":"WebPage","@id":"https://notfiles.xyz/2018/12/04/day-4-intersections/"},"url":"https://notfiles.xyz/2018/12/04/day-4-intersections/"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">

  <!-- The loading of KaTeX is deferred to speed up page rendering -->
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script>

  <!-- To automatically render math in text elements, include the auto-render extension: -->
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"
      onload="renderMathInElement(document.body);"></script>
</head>
<body><header class="site-header">
  <div class="wrapper">
    <a class="site-title" href="/">not://files v3.0</a><nav class="site-nav" id="site-navigation" aria-label="Menu">
  <label for="site-menu-toggle" class="menu-icon" aria-label="Menu">
    <i class="fas fa-bars"></i>
  </label>
  <input id="site-menu-toggle" class="menu-toggle" type="checkbox"/><ul id="site-menu" class="menu">
    <li class="menu-item">
      <a class="page-link" href="/posts/">
          All Posts
        </a></li>
    <li class="menu-item">
      <a class="page-link" href="/archive/">
          Archives
        </a></li>
    <li class="menu-item">
      <a class="page-link" href="/category/">
          Categories
        </a></li>
    <li class="menu-item">
      <a class="page-link" href="/tag/">
          Tags
        </a></li>
</ul>
</nav>
</div>
</header>
<section class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Day 4, Intersections</h1>
    <div class="post-meta"><time datetime="2018-12-04T23:34:42+01:00" itemprop="datePublished">Tuesday, 2018-12-04</time>
       in
    <a href="/category/devlog/"
       title="Development Logs">devlog</a>
   about
    <a href="/tag/devember/" title="participation in Devember">
      #devember</a>,
  
    <a href="/tag/devember2018/" title="Devember 2018 ray tracer challenge">
      #devember2018</a>,
  
    <a href="/tag/hourofcode/" title="coding for one hour per day">
      #hourofcode</a>,
  
    <a href="/tag/raytracerchallenge/" title="">
      #raytracerchallenge</a>
  </div></header>

  <section class="post-content" itemprop="articleBody">
    <p>More math heavy stuff, calculating the positions along a ray, where it intersects a sphere. Turns out this is as simple as solving a quadratic equation, with some special coefficients.</p>

\[\|\dot{O} + t\overrightarrow{D} - \dot{C}\|^2 = R^2\]

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">)</span>
  <span class="n">sphere_to_ray</span> <span class="o">=</span> <span class="n">ray</span><span class="p">.</span><span class="nf">origin</span> <span class="o">-</span> <span class="vi">@origin</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">ray</span><span class="p">.</span><span class="nf">direction</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">ray</span><span class="p">.</span><span class="nf">direction</span><span class="p">)</span>
  <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ray</span><span class="p">.</span><span class="nf">direction</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">sphere_to_ray</span><span class="p">)</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">sphere_to_ray</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">sphere_to_ray</span><span class="p">)</span> <span class="o">-</span> <span class="vi">@radius_squared</span>

  <span class="n">intersections</span> <span class="o">=</span> <span class="n">quadratic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">).</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span> <span class="no">Intersection</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">self</span><span class="p">)</span> <span class="p">}</span>
  <span class="no">Intersections</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="o">*</span><span class="n">intersections</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>I also had to refactor the symbolic evaluation helpers I use to evaluate the <a href="https://docs.cucumber.io/gherkin/reference/">gherkin</a> expressions that makes up the specification.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">seval</span><span class="p">(</span><span class="n">recv</span><span class="p">,</span> <span class="nb">method</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
  <span class="k">case</span> <span class="nb">method</span>
  <span class="k">when</span> <span class="ss">:'='</span>
    <span class="nb">instance_variable_set</span><span class="p">(</span><span class="n">recv</span><span class="p">,</span> <span class="n">seval</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
  <span class="k">when</span> <span class="kp">nil</span>
    <span class="n">recv</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span> <span class="p">?</span> <span class="nb">instance_variable_get</span><span class="p">(</span><span class="n">recv</span><span class="p">)</span> <span class="p">:</span> <span class="n">recv</span>
  <span class="k">else</span>
    <span class="n">fcall</span><span class="p">(</span><span class="n">map_operator</span><span class="p">(</span><span class="nb">method</span><span class="p">),</span> <span class="n">recv</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">fcall</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
  <span class="nb">method</span><span class="p">.</span><span class="nf">to_proc</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg</span><span class="o">|</span>
    <span class="n">arg</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span> <span class="p">?</span> <span class="nb">instance_variable_get</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="p">:</span> <span class="n">arg</span>
  <span class="k">end</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>


  </section>
</article>
<section class="post-list"><h2>Next related</h2><article class="post-item">
  <header class="post-header">
    <h3 class="post-link">
      <a href="/2018/12/05/day-5-bumping-in-to-things/" >
        Day 5, Assume nothing
      </a>
    </h3>
    <div class="post-meta">Wednesday, 2018-12-05 in
    <a href="/category/devlog/"
       title="Development Logs">devlog</a>
   about
    <a href="/tag/devember/" title="participation in Devember">
      #devember</a>,
  
    <a href="/tag/devember2018/" title="Devember 2018 ray tracer challenge">
      #devember2018</a>,
  
    <a href="/tag/hourofcode/" title="coding for one hour per day">
      #hourofcode</a>,
  
    <a href="/tag/raytracerchallenge/" title="">
      #raytracerchallenge</a>,
  
    <a href="/tag/ruby/" title="coding in Ruby">
      #ruby</a>
  
    </div>
  </header>
  <section class="post-excerpt">
    <blockquote>
      Today I Learned that I shouldn’t have assumed the sphere would ever need to change from being a unit sphere, so intersecting gets even simpler:

    </blockquote>
  </section>
</article>
<h2>Previous related</h2><article class="post-item">
  <header class="post-header">
    <h3 class="post-link">
      <a href="/2018/12/03/day-3-casting-rays-into-spheres/" >
        Day 3, Casting rays into spheres
      </a>
    </h3>
    <div class="post-meta">Monday, 2018-12-03 in
    <a href="/category/devlog/"
       title="Development Logs">devlog</a>
   about
    <a href="/tag/devember/" title="participation in Devember">
      #devember</a>,
  
    <a href="/tag/devember2018/" title="Devember 2018 ray tracer challenge">
      #devember2018</a>,
  
    <a href="/tag/hourofcode/" title="coding for one hour per day">
      #hourofcode</a>,
  
    <a href="/tag/raytracerchallenge/" title="">
      #raytracerchallenge</a>,
  
    <a href="/tag/ruby/" title="coding in Ruby">
      #ruby</a>
  
    </div>
  </header>
  <section class="post-excerpt">
    <blockquote>
      Finally some practical applications of the math heavy weekend, casting abstract rays at abstract spheres. Well, on a sliding scale from linear algebra to physical representation, it’s still a step in the direction.

    </blockquote>
  </section>
</article>
<article class="post-item">
  <header class="post-header">
    <h3 class="post-link">
      <a href="/2018/12/02/day-2-matrices-matrices-matrices-oh-and-more-matrices/" >
        Day 2, Matrices, matrices, matrices. Oh, and more matrices
      </a>
    </h3>
    <div class="post-meta">Sunday, 2018-12-02 in
    <a href="/category/devlog/"
       title="Development Logs">devlog</a>
   about
    <a href="/tag/devember/" title="participation in Devember">
      #devember</a>,
  
    <a href="/tag/devember2018/" title="Devember 2018 ray tracer challenge">
      #devember2018</a>,
  
    <a href="/tag/hourofcode/" title="coding for one hour per day">
      #hourofcode</a>,
  
    <a href="/tag/ruby/" title="coding in Ruby">
      #ruby</a>,
  
    <a href="/tag/raytracerchallenge/" title="">
      #raytracerchallenge</a>,
  
    <a href="/tag/tauism/" title="">
      #tauism</a>
  
    </div>
  </header>
  <section class="post-excerpt">
    <blockquote>
      Today was spent on a heavy chunk of linear algebra, matrices. This is the foundation for everything else, so time well spent reimplementing what’s already in the stdlib, just to refresh my math skills. If there are still days left of Devember when I’m finished, I’ll come back and replace all this with the stdlib implementation instead, hoping I’m somewhat close to the same API.


    </blockquote>
  </section>
</article>
<article class="post-item">
  <header class="post-header">
    <h3 class="post-link">
      <a href="/2018/12/01/day-1-overdoing-it/" >
        Day 1, Overdoing it
      </a>
    </h3>
    <div class="post-meta">Saturday, 2018-12-01 in
    <a href="/category/devlog/"
       title="Development Logs">devlog</a>
   about
    <a href="/tag/devember/" title="participation in Devember">
      #devember</a>,
  
    <a href="/tag/devember2018/" title="Devember 2018 ray tracer challenge">
      #devember2018</a>,
  
    <a href="/tag/hourofcode/" title="coding for one hour per day">
      #hourofcode</a>,
  
    <a href="/tag/raytracerchallenge/" title="">
      #raytracerchallenge</a>,
  
    <a href="/tag/ruby/" title="coding in Ruby">
      #ruby</a>
  
    </div>
  </header>
  <section class="post-excerpt">
    <blockquote>
      The first proper day of Devember is here. Of course I overdid it and spent all day coding, instead of just that one hour.

    </blockquote>
  </section>
</article>
</section>

      </div>
    </section><footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Calle Englund</li>
          <li><a href="mailto:calle@notfiles.xyz">calle@notfiles.xyz</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list"><li title="GitHub">
            <a rel="me" href="https://github.com/notCalle">
              <i class="icon fab fa-github"></i>
              notCalle
            </a>
          </li><li title="Mastodon">
            <a rel="me" href="https://mstdn.social/@notCalle">
              <i class="icon fab fa-mastodon"></i>
              @notCalle@mstdn.social
            </a>
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        Random development ramblings, maybe.

      </div>
    </div>

  </div>

</footer>
</body>
</html>
